---
title: "BADM Update 7/30/2025"
author: "Lindsey Bell"
format: html
editor: visual
echo: false
message: false
warning: false
---

## Project Overview

Biological, Ancillary, Disturbance, and Metadata (BADM) are information that complement the meteorological/flux measurements collected at flux towers by providing context on the site's environment. These data are submitted by tower PIs and are critical for interpreting ecosystem function, site conditions, and disturbance history. However, though PIs may have large amounts of information for their sites, BADM are frequently under-reported in official data submissions.

We are currently compiling and evaluating BADM for 13 flux towers located across Arizona and New Mexico. These sites span a broad elevational gradient and represent diverse ecosystems in the Southwest, offering an opportunity to examine spatial variation in site characteristics.

## Data Status

We summarize the availability of 45 core BADM variables from soils and vegetation metadata groups using the BADM currently available in the AmeriFlux database as well as metadata that have been collected but not submitted.  

```{r}
#| fig-align: center

library(dplyr)
library(tidyr)
library(tidyverse)
library(ggplot2)

corefields <- read.csv("./Data/VegSoil_BADM - CoreFields.csv")
corefields <- corefields[2:nrow(corefields), 1:14]


#data availability by site======================================================

site_order <- names(corefields)[which(startsWith(names(corefields), "US."))]

dat_long <- corefields %>%
  pivot_longer(
    cols = starts_with("US."),
    names_to = "site",
    values_to = "status"
  ) %>%
  mutate(site = factor(site, levels = site_order))

counts <- dat_long %>%
  mutate(status = as.integer(status)) %>%
  group_by(site, status) %>%
  summarize(n = n(), .groups = "drop") %>%
  mutate(
    status = factor(status, levels = c(0, 10, 11),
                    labels = c("Not Available", "Available from PI", "Available in BADM"))
  )

status_colors <- c(
  "Not Available" = "#D73027",
  "Available from PI" = "#FC8D59",
  "Available in BADM" = "#1A9850"
)

ggplot(counts, aes(x = n, y = site, fill = status)) +
  geom_bar(stat = "identity") +
  scale_fill_manual(values = status_colors) +
  scale_x_continuous(breaks = seq(0, max(counts$n), by = 10)) +
  labs(
    x = "Number of Variables",
    y = "Site",
    fill = "Data Status",
    title = "Data Availability by Site"
  ) +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 0, hjust = 1, size = 15),
        axis.title.x = element_text(size = 15),
        axis.title.y = element_text(size = 15),
        axis.text.y = element_text(size = 15),
        legend.title = element_text(size = 13),
        legend.text = element_text(size = 12),
        legend.position = "right",
        plot.title = element_text(size = 20))
```
Most sites have slightly less than half of the core BADM fields available from either Ameriflux or the site PI. However, when only considering officially submitted data, metadata availability is extremely low across all sites. 

```{r}
#| fig-width: 12
#| fig-height: 12
#| fig-align: center

corefields <- read.csv("./Data/VegSoil_BADM - CoreFields.csv")
corefields <- corefields[2:nrow(corefields), 1:14]
names(corefields)[1] <- "variable"

corefields$variable <- factor(corefields$variable, levels = corefields$variable)

dat_long_var <- corefields %>%
  pivot_longer(
    cols = starts_with("US."),
    names_to = "site",
    values_to = "status"
  ) %>%
  mutate(status = as.integer(status))

counts_by_var <- dat_long_var %>%
  group_by(variable, status) %>%
  summarise(n = n(), .groups = "drop") %>%
  mutate(
    status = factor(status, levels = c(0, 10, 11),
                    labels = c("Not Available", "Available from PI", "Available in BADM"))
  )

ggplot(counts_by_var, aes(x = n, y = variable, fill = status)) +
  geom_bar(stat = "identity") +
  scale_fill_manual(values = status_colors) +
  scale_x_continuous(breaks = seq(0, max(counts_by_var$n, na.rm = TRUE), by = 1)) +
  labs(
    x = "Number of Sites",
    y = "BADM Code",
    fill = "Data Status",
    title = "Data Availability by Variable"
  ) +
  theme_minimal() +
  theme(axis.text.x = element_text(size = 14),
        axis.title.x = element_text(size = 18),
        axis.text.y = element_text(size = 14),
        axis.title.y = element_text(size = 18),
        legend.title = element_text(size = 18),
        legend.text = element_text(size = 16),
        legend.position = "right",
        plot.title = element_text(size = 22))
```

There are 18 core variables with availability across a majority of the sites when considering both  BADM submissions and PI-available data. No variables are available at a majority of the sites using only BADM submissions. The most commonly available data are variables related to soil texture, soil nitrogen and carbon content, and tree metrics. Although a significant amount of metadata has been collected across all sites, only a small portion has been formally submitted to the network.